"""
Pytest configuration and shared fixtures

이 파일은 모든 테스트에서 공통으로 사용하는 fixture를 정의합니다.
"""

import pytest
from unittest.mock import Mock
from datetime import datetime
from typing import Dict, Any


# ============================================================================
# Sample Data Fixtures
# ============================================================================

@pytest.fixture
def sample_inbody_data() -> Dict[str, Any]:
    """테스트용 샘플 InBody 데이터"""
    return {
        "기본정보": {
            "신장": 175.0,
            "연령": 30,
            "성별": "남성"
        },
        "체성분": {
            "체수분": 42.5,
            "단백질": 12.0,
            "무기질": 4.2,
            "체지방": 18.5
        },
        "체중관리": {
            "체중": 75.0,
            "골격근량": 35.0,
            "체지방량": 18.5,
            "적정체중": 70.0,
            "체중조절": -5.0,
            "지방조절": -8.5,
            "근육조절": 3.5
        },
        "비만분석": {
            "BMI": 24.5,
            "체지방률": 24.7,
            "복부지방률": 0.88,
            "내장지방레벨": 7,
            "비만도": 107
        },
        "연구항목": {
            "제지방량": 56.5,
            "기초대사량": 1650,
            "권장섭취열량": 2400
        },
        "부위별근육분석": {
            "왼쪽팔": "표준",
            "오른쪽팔": "표준",
            "복부": "부족",
            "왼쪽하체": "발달",
            "오른쪽하체": "발달"
        },
        "부위별체지방분석": {
            "왼쪽팔": "표준",
            "오른쪽팔": "표준",
            "복부": "표준이상",
            "왼쪽하체": "표준",
            "오른쪽하체": "표준"
        }
    }


@pytest.fixture
def prev_inbody_data() -> Dict[str, Any]:
    """테스트용 이전 InBody 데이터"""
    return {
        "기본정보": {
            "신장": 175.0,
            "연령": 30,
            "성별": "남성"
        },
        "체성분": {
            "체수분": 41.0,
            "단백질": 11.5,
            "무기질": 4.0,
            "체지방": 22.0
        },
        "체중관리": {
            "체중": 78.5,
            "골격근량": 33.0,
            "체지방량": 22.0,
            "적정체중": 70.0,
            "체중조절": -8.5,
            "지방조절": -12.0,
            "근육조절": 3.5
        },
        "비만분석": {
            "BMI": 25.6,
            "체지방률": 28.0,
            "복부지방률": 0.95,
            "내장지방레벨": 9,
            "비만도": 112
        },
        "연구항목": {
            "제지방량": 56.5,
            "기초대사량": 1600,
            "권장섭취열량": 2350
        },
        "부위별근육분석": {
            "왼쪽팔": "표준",
            "오른쪽팔": "표준",
            "복부": "부족",
            "왼쪽하체": "표준",
            "오른쪽하체": "표준"
        },
        "부위별체지방분석": {
            "왼쪽팔": "표준이상",
            "오른쪽팔": "표준이상",
            "복부": "표준이상",
            "왼쪽하체": "표준이상",
            "오른쪽하체": "표준이상"
        }
    }


# ============================================================================
# Mock Fixtures
# ============================================================================

@pytest.fixture
def mock_llm_client():
    """Mock LLM 클라이언트"""
    mock = Mock()
    mock.generate_chat = Mock(return_value="Mock LLM 응답")
    mock.generate_chat_with_history = Mock(return_value="Mock 대화 응답")
    mock.create_embedding = Mock(return_value=[0.1] * 1536)
    return mock


@pytest.fixture
def mock_db_session():
    """Mock DB 세션"""
    return Mock()


# ============================================================================
# Pytest Configuration
# ============================================================================

def pytest_configure(config):
    """Pytest 설정"""
    config.addinivalue_line(
        "markers", "unit: 유닛 테스트"
    )
    config.addinivalue_line(
        "markers", "integration: 통합 테스트"
    )
    config.addinivalue_line(
        "markers", "e2e: End-to-End 테스트"
    )
