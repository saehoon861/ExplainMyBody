"""
룰 데이터 정의
- 순수 룰 dict만 관리 (파싱·프롬프트 로직 없음)
- 향후 DB에서 로드하는 구조로 대체 가능
- 우선순위: Health (최우선) > Goal > BodyType1 > BodyType2 > Preference
"""

from typing import Dict, List


# =============================================================================
# BodyType 룰
# =============================================================================

BODY_TYPE1_RULES: Dict[str, Dict] = {
    "마른형": {
        "tendency": ["근육량 부족", "체중 증가 어려움"],
        "diet": {
            "require": ["충분한 총 칼로리", "탄수화물+단백질 동시 증가"],
            "avoid": ["극단적 저탄수"],
        },
        "training": {
            "avoid": ["과도한 유산소"],
        },
        "coach_tone": "지금은 살 빼는 단계가 아니라 몸을 채우는 시기입니다.",
    },
    "마른근육형": {
        "tendency": ["근육베이스 양호", "체중 증가 필요"],
        "diet": {
            "require": ["단백질 유지", "깨끗한 칼로리 증가"],
            "avoid": ["급격한 벌크"],
        },
        "training": {
            "avoid": ["과도한 유산소"],
        },
        "coach_tone": "이미 좋은 베이스가 있어요. 천천히 쌓아가면 됩니다.",
    },
    "표준형": {
        "tendency": ["균형잡힌 체성분"],
        "diet": {
            "require": ["균형 잡힌 식단", "단백질 챙기기"],
            "avoid": [],
        },
        "training": {
            "avoid": [],
        },
        "coach_tone": "가장 좋은 출발점이에요. 꾸준히만 하면 됩니다.",
    },
    "근육형": {
        "tendency": ["근육량 충분", "체지방 관리 필요"],
        "diet": {
            "require": ["단백질 높게", "운동 전후 탄수화물"],
            "avoid": ["단백질 삭감"],
        },
        "training": {
            "avoid": ["오버트레이닝"],
        },
        "coach_tone": "이제 디테일 싸움입니다. 루틴 지키는 게 핵심이에요.",
    },
    "고근육체형": {
        "tendency": ["근육량 최고", "유지 관리 단계"],
        "diet": {
            "require": ["현재 식이 유지", "단백질 유지"],
            "avoid": ["급격한 식단 변화"],
        },
        "training": {
            "avoid": ["무리한 증량"],
        },
        "coach_tone": "이미 잘 만들어놨어요. 유지가 제일 어려운 거 아시죠?",
    },
    "비만형": {
        "tendency": ["체지방 과다"],
        "diet": {
            "require": ["칼로리 적자", "단백질 유지"],
            "avoid": ["액상 칼로리", "가공식품"],
        },
        "training": {
            "avoid": ["관절 부담 큰 점프"],
        },
        "coach_tone": "굶는 감량 말고, 오래 가는 감량이 목표입니다.",
    },
    "고도비만형": {
        "tendency": ["체지방 과다", "관절 부담 높음"],
        "diet": {
            "require": ["단백질 챙기기", "채소 많이"],
            "avoid": ["급격한 칼로리 삭감", "고열량 가공식품"],
        },
        "training": {
            "avoid": ["관절 부담 큰 운동", "점프"],
        },
        "coach_tone": "급하게 가면 다쳐요. 천천히 가는 게 제일 빠른 길입니다.",
    },
    "마른비만형": {
        "tendency": ["근육 부족", "체지방 비율 높음"],
        "diet": {
            "require": ["단백질 우선 확보", "총 칼로리 관리"],
            "avoid": ["야식", "당류 위주 식사"],
        },
        "training": {
            "avoid": ["유산소만 하는 루틴"],
        },
        "coach_tone": "몸무게보다 구성부터 바꿔야 하는 타입입니다.",
    },
    "알 수 없음": {
        "tendency": [],
        "diet": {"require": [], "avoid": []},
        "training": {"prefer": [], "avoid": []},
        "coach_tone": "기본부터 차근차근 만들어가면 됩니다.",
    },
}

BODY_TYPE2_RULES: Dict[str, Dict] = {
    "하체비만형": {
        "focus": ["하체 체지방 감소", "상체 근력 강화"],
        "training_adjustment": {
            "lower": ["유산소 비중 ↑", "저중량 고반복"],
            "upper": ["근력 집중"],
        },
        "coach_tone": "하체는 늦게 빠지지만 빠지면 체형이 확 바뀝니다.",
    },
    "상체비만형": {
        "focus": ["상체 체지방 감소", "하체 근력 강화"],
        "training_adjustment": {
            "lower": ["근력 집중"],
            "upper": ["유산소 비중 ↑", "저중량 고반복"],
        },
        "coach_tone": "하체 키우면 상체가 상대적으로 날씬해 보여요.",
    },
    "상체발달형": {
        "focus": ["하체 근육 강화"],
        "training_adjustment": {
            "lower": ["근력 볼륨 ↑"],
            "upper": ["유지 수준"],
        },
        "coach_tone": "하체가 받쳐줘야 상체도 더 커 보여요.",
    },
    "하체발달형": {
        "focus": ["상체 근육 강화"],
        "training_adjustment": {
            "lower": ["유지 수준"],
            "upper": ["근력 볼륨 ↑"],
        },
        "coach_tone": "하체는 이미 충분해요. 상체 채우면 비율 예뻐져요.",
    },
    "표준형": {
        "focus": ["전신 균형"],
        "training_adjustment": {},
        "coach_tone": "밸런스 좋아요. 이대로 유지하면서 전체적으로 키워가요.",
    },
}


# =============================================================================
# Health 룰 (최우선 — forbid는 절대 어기면 안 됨)
# =============================================================================

HEALTH_RULES: Dict[str, Dict] = {
    "허리 디스크": {
        "forbid": ["데드리프트", "허리 비틀림", "고중량 스쿼트"],
        "require": ["코어 안정화", "머신 위주"],
    },
    "관절염": {
        "forbid": ["점프", "달리기"],
        "require": ["저충격 운동"],
    },
    "심장 질환": {
        "forbid": ["고강도 인터벌"],
        "require": ["강도 관리", "충분한 휴식"],
    },
    "고혈압": {
        "forbid": ["고강도 무기산소 운동"],
        "require": ["강도 관리", "충분한 휴식"],
    },
    "당뇨": {
        "forbid": [],
        "require": ["혈당 관리 식단", "규칙적 운동"],
    },
    "호흡기 질환": {
        "forbid": ["고강도 운동"],
        "require": ["강도 낮추기"],
    },
    "근골격계 질환": {
        "forbid": ["무리한 중량", "충격 운동"],
        "require": ["부상 부위 휴식", "저충격 운동"],
    },
    "기타": {
        "forbid": [],
        "require": ["개별 건강 상태에 맞게 운동 강도 조정"],
        "user_input_note": "사용자가 직접 입력한 건강 특이사항 (medicalConditionsDetail)"
    },
}


# =============================================================================
# Goal 룰 (단순 텍스트만 포함, 세부 프롬프트는 REHAB_RULES에서 처리)
# =============================================================================

GOAL_RULES: Dict[str, Dict] = {
    "감량": {},
    "증량": {},
    "유지": {},
    "재활": {},  # 재활의 경우 REHAB_RULES가 실제 룰 적용
}


# =============================================================================
# Rehab 룰 (goal_type="재활" + goal_description 부위명으로 트리거)
# =============================================================================

REHAB_RULES: Dict[str, Dict] = {
    "허리 재활": {
        "forbid": ["데드리프트", "고중량 스쿼트", "허리 비틀림", "점프"],
        "require": ["코어 안정화", "저충격 운동"],
    },
    "어깨 재활": {
        "forbid": ["오버헤드 프레스", "무거운 바벨 운동", "어깨 비틀림"],
        "require": ["어깨 안정화 운동", "회전근개 강화"],
    },
    "무릎 재활": {
        "forbid": ["점프", "깊은 스쿼트", "달리기"],
        "require": ["무릎 안정화", "대퇴근육 강화"],
    },
    "목 재활": {
        "forbid": ["백 스쿼트", "목에 충격 가는 운동", "무거운 백팩"],
        "require": ["목 안정화 운동", "경추 스트레칭"],
    },
    "발목 재활": {
        "forbid": ["점프", "달리기", "급격한 방향 전환"],
        "require": ["발목 안정화", "균형 운동"],
    },
    "기타 재활": {
        "forbid": ["과도한 부하", "통증 유발 운동"],
        "require": ["개별 재활 부위에 맞는 운동", "통증 없는 범위"],
        "user_input_note": "사용자가 직접 입력한 재활 부위 (goal 필드)"
    },
}


# =============================================================================
# Preference 룰 (최하위 — 다른 룰과 충돌 시 밑순위)
# Frontend 기본값: "보통" (사용자가 선택하지 않아도 자동으로 "보통" 전달됨)
# =============================================================================

PREFERENCE_RULES: Dict[str, Dict] = {
    "매우 낮음": {
        "avoid": ["고강도운동"],
    },
    "보통": {  # 기본값
        "avoid": [],
    },
    "매우 높음": {
        "avoid": [],
    },
}


# =============================================================================
# 선호 운동 타입 룰 (frontend preferredExercisesList와 동일 항목)
# =============================================================================

EXERCISE_TYPE_RULES: Dict[str, Dict] = {
    "유산소": {
        "usage_note": "심박수 상승을 목표로 한 지속 운동 위주",
    },
    "무산소": {
        "usage_note": "근육 수축과 저항이 명확한 운동만 포함",
    },
    "러닝": {
        "usage_note": "HIIT로 확장하지 말 것",
    },
    "걷기": {
        "usage_note": "등산, 트레킹으로 자동 확장 금지",
    },
    "고강도운동": {
        "usage_note": "짧은 시간, 높은 심박. 초보자에게 남용 금지",
    },
    "웨이트": {
        "usage_note": "무산소 운동 중에서도 중량 중심",
    },
    "요가": {
        "usage_note": "명상 단독 루틴으로 확장하지 말 것",
    },
    "필라테스": {
        "usage_note": "재활/코어 목적에 적합",
    },
    "맨몸운동": {
        "usage_note": "점프 동작은 별도 고강도 취급",
    },
    "실내운동": {
        "usage_note": "운동 종류가 아닌 장소 개념",
    },
    "실외운동": {
        "usage_note": "날씨/지면 고려 언급 가능",
    },
    "기타": {
        "usage_note": "사용자 커스텀 운동 타입 (현재 frontend 미구현)",
        "frontend_status": "입력 필드 없음 - 향후 추가 필요"
    },
}

# EXERCISE_TYPE_LIST: 매칭용 키 목록 (EXERCISE_TYPE_RULES에서 유도)
EXERCISE_TYPE_LIST: List[str] = list(EXERCISE_TYPE_RULES.keys())
